- name: -----> Prepare LOCALHOST
  hosts: localhost
  become: yes
  vars:
    project_name: "{{ lookup('env','PROJECT_NAME') }}" 
    kz_zip: /home/jenkins/projects/{{ project_name }}/kz.zip
    isbp_maven: /home/jenkins/jenkans/{{ project_name }}/docker/docker4run/isbp-maven.xml
    isbp_maven_gs: /home/jenkins/jenkans/{{ project_name }}/docker/docker4run/isbp-settings.xml
  
  tasks:
  - name: Check exist .m2/repository project directory
    stat: 
      path: "/home/jenkins/.m2/repository/kz"
    register: m2_stat

  - name: Check exists isbp maven file in /etc/maven dir
    stat: 
      path: "/etc/maven/isbp.xml"
    register: maven_stat
    
  - name: Check exists isbp maven file in /etc/maven dir
    stat: 
      path: "/etc/maven/isbp-settings.xml"
    register: maven_stat_gs
    
  - block:
    - name: Create directory /etc/maven
      file: 
        path: /etc/maven
        state: directory
        
    - name: Copy Maven file
      copy: src={{ isbp_maven }} dest=/etc/maven/isbp.xml

    - name: Copy Maven GS file
      copy: src={{ isbp_maven_gs }} dest=/etc/maven/
    when: not maven_stat.stat.exists or not maven_stat_gs.stat.exists
    
  - block:
    - name: Check ~/.m2 project directory
      file: 
        path: "~/.m2/repository/kz"
        state: directory
        
    - name: create .m2 directory
      shell: unzip -d ~/.m2/repository {{ kz_zip }} 
    when: not m2_stat.stat.exists
