- name: Run Service 
  hosts: web-isbp
  vars:
    project_name: "{{ lookup('env','PROJECT_NAME') }}"
    project_port: "{{ lookup('env','PROJECT_PORT') }}"
    home_dir: /home/ansible/docker-projects/{{ project_name }}/docker4run/   
    logs_dir: /home/ansible/docker-projects/{{ project_name }}/logs
    deployments_dir: /home/jenkins/projects/{{ project_name }}/deployments

  tasks:
  - name: Check exist (create) project`s logs directory {{ logs_dir }}
    file: 
      path: "{{ logs_dir }}"
      state: directory    
      
  - name: Check exist (create) project`s deployments directory {{ deployments_dir }}
    file: 
      path: "{{ deployments_dir }}"
      state: directory    
  
  - name: Stopping service {{ project_name }}
    shell: cd {{ home_dir }} && docker-compose stop {{ project_name }}   

  - name: Starting docker-compose
    shell: cd {{ home_dir }} && docker-compose up -d --build
    
  - name: Starting service {{ project_name }}
    shell: cd {{ home_dir }} && docker-compose start {{ project_name }}
    
